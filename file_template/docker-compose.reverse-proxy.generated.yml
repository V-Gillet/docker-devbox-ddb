# This configuration file has been automatically generated by docker-devbox
version: '${VERSION}'

networks:
  reverse-proxy:
    name: '${DOCKER_DEVBOX_REVERSE_PROXY_NETWORK}'
    external: true

services:
  traefikV1:
    labels:
      - 'traefik.enable=true'
      - 'traefik.${SERVICE_DOMAIN_PREFIX}frontend.rule=Host:$SERVICE_DOMAIN_PREFIX\${DOCKER_DEVBOX_DOMAIN_PREFIX}.\${DOCKER_DEVBOX_DOMAIN}'
      - 'traefik.${SERVICE_DOMAIN_PREFIX}port=$SERVICE_PORT'
    networks:
      - default
      - reverse-proxy
  traefikV2:
    labels:
      - 'traefik.enable=true'
      - 'traefik.http.routers.${COMPOSE_PROJECT_NAME}${ROUTER_DOMAIN_SUFFIX}.rule=Host(\`$SERVICE_DOMAIN_PREFIX\${DOCKER_DEVBOX_DOMAIN_PREFIX}.\${DOCKER_DEVBOX_DOMAIN}\`)'
      - 'traefik.http.routers.${COMPOSE_PROJECT_NAME}${ROUTER_DOMAIN_SUFFIX}.service=${COMPOSE_PROJECT_NAME}${ROUTER_DOMAIN_SUFFIX}'
      - 'traefik.http.routers.${COMPOSE_PROJECT_NAME}${ROUTER_DOMAIN_SUFFIX}-tls.rule=Host(\`$SERVICE_DOMAIN_PREFIX\${DOCKER_DEVBOX_DOMAIN_PREFIX}.\${DOCKER_DEVBOX_DOMAIN}\`)'
      - 'traefik.http.routers.${COMPOSE_PROJECT_NAME}${ROUTER_DOMAIN_SUFFIX}-tls.tls=true'
      - 'traefik.http.routers.${COMPOSE_PROJECT_NAME}${ROUTER_DOMAIN_SUFFIX}-tls.service=${COMPOSE_PROJECT_NAME}${ROUTER_DOMAIN_SUFFIX}'
      - 'traefik.http.services.${COMPOSE_PROJECT_NAME}${ROUTER_DOMAIN_SUFFIX}.loadbalancer.server.port=$SERVICE_PORT'
    networks:
      - default
      - reverse-proxy
  nginx:
    environment:
      - 'VIRTUAL_HOST=$SERVICE_DOMAIN_PREFIX\${DOCKER_DEVBOX_DOMAIN_PREFIX}.\${DOCKER_DEVBOX_DOMAIN}'
      - 'VIRTUAL_PORT=$SERVICE_PORT'
    networks:
      - default
      - reverse-proxy